{% extends 'social/base.html' %}

{% block content %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ù…ÙŠØ²Ø©</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        h1 {
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 10px;
        }
        
        .game-info {
            display: flex;
            justify-content: space-around;
            width: 100%;
            max-width: 600px;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .info-box {
            text-align: center;
        }
        
        .game-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            max-width: 600px;
            margin: 0 auto;
            perspective: 1000px;
        }
        
        .card {
            width: 120px;
            height: 160px;
            position: relative;
            transform-style: preserve-3d;
            transition: all 0.5s ease;
            cursor: pointer;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
        }
        
        .card-front {
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            transform: rotateY(180deg);
        }
        
        .card-back {
            background: linear-gradient(45deg, #0f2027, #203a43, #2c5364);
            color: white;
        }
        
        .card.flipped {
            transform: rotateY(180deg);
        }
        
        .card.matched {
            transform: rotateY(180deg);
            box-shadow: 0 0 15px gold;
            cursor: default;
        }
        
        .card.matched .card-front {
            background: linear-gradient(45deg, #4CAF50, #2E7D32);
        }
        
        .controls {
            margin-top: 30px;
            display: flex;
            gap: 15px;
        }
        
        button {
            padding: 12px 25px;
            font-size: 16px;
            background: linear-gradient(45deg, #4e54c8, #8f94fb);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        .difficulty {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }
        
        .difficulty button {
            padding: 8px 15px;
            font-size: 14px;
        }
        
        .timer-animation {
            width: 100%;
            height: 5px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .timer-progress {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 100%;
            transition: width 1s linear;
        }
        
        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            display: none;
        }
        
        @media (max-width: 600px) {
            .game-container {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            
            .card {
                width: 80px;
                height: 120px;
                font-size: 30px;
            }
        }
    </style>
</head>
<body>
    <h1>Ù„Ø¹Ø¨Ø© Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ù…ÙŠØ²Ø©</h1>
    
    <div class="game-info">
        <div class="info-box">
            <div>Ø§Ù„ÙˆÙ‚Øª</div>
            <div id="timer">00:00</div>
            <div class="timer-animation">
                <div class="timer-progress" id="timer-progress"></div>
            </div>
        </div>
        <div class="info-box">
            <div>Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</div>
            <div id="moves">0</div>
        </div>
        <div class="info-box">
            <div>Ø§Ù„Ø£Ø²ÙˆØ§Ø¬</div>
            <div id="pairs">0 / 8</div>
        </div>
    </div>
    
    <div class="game-container" id="game-board"></div>
    
    <div class="difficulty">
        <button id="easy-btn">Ø³Ù‡Ù„ (4x3)</button>
        <button id="medium-btn">Ù…ØªÙˆØ³Ø· (4x4)</button>
        <button id="hard-btn">ØµØ¹Ø¨ (6x4)</button>
    </div>
    
    <div class="controls">
        <button id="restart-btn">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¨Ø¯Ø¡</button>
        <button id="hint-btn">Ù…Ø³Ø§Ø¹Ø¯Ø©</button>
    </div>
    
    <div class="celebration" id="celebration"></div>
    
    <script>
        // Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù„Ø¹Ø¨Ø©
        const gameBoard = document.getElementById('game-board');
        const timerDisplay = document.getElementById('timer');
        const movesDisplay = document.getElementById('moves');
        const pairsDisplay = document.getElementById('pairs');
        const timerProgress = document.getElementById('timer-progress');
        const restartBtn = document.getElementById('restart-btn');
        const hintBtn = document.getElementById('hint-btn');
        const easyBtn = document.getElementById('easy-btn');
        const mediumBtn = document.getElementById('medium-btn');
        const hardBtn = document.getElementById('hard-btn');
        const celebration = document.getElementById('celebration');
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
        let cards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let moves = 0;
        let seconds = 0;
        let timer;
        let gameStarted = false;
        let totalPairs = 8;
        let boardSize = 'medium';
        let hintAvailable = true;
        
        // Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
        const symbols = ['ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 
                        'ğŸ¦', 'ğŸ®', 'ğŸ·', 'ğŸ¸', 'ğŸµ', 'ğŸ”', 'ğŸ§', 'ğŸ¦'];
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        function initGame() {
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø­Ø¬Ù… Ø§Ù„Ù„ÙˆØ­Ø© Ø­Ø³Ø¨ Ø§Ù„ØµØ¹ÙˆØ¨Ø©
            switch(boardSize) {
                case 'easy':
                    totalPairs = 6;
                    gameBoard.style.gridTemplateColumns = 'repeat(3, 1fr)';
                    break;
                case 'medium':
                    totalPairs = 8;
                    gameBoard.style.gridTemplateColumns = 'repeat(4, 1fr)';
                    break;
                case 'hard':
                    totalPairs = 12;
                    gameBoard.style.gridTemplateColumns = 'repeat(4, 1fr)';
                    break;
            }
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
            gameBoard.innerHTML = '';
            flippedCards = [];
            matchedPairs = 0;
            moves = 0;
            seconds = 0;
            gameStarted = false;
            hintAvailable = true;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
            movesDisplay.textContent = moves;
            pairsDisplay.textContent = `0 / ${totalPairs}`;
            timerDisplay.textContent = '00:00';
            timerProgress.style.width = '100%';
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
            createCards();
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
        function createCards() {
            cards = [];
            
            // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø±Ù…ÙˆØ² Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø²ÙˆØ§Ø¬
            const selectedSymbols = symbols.slice(0, totalPairs);
            const cardSymbols = [...selectedSymbols, ...selectedSymbols];
            
            // Ø®Ù„Ø· Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
            for (let i = cardSymbols.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [cardSymbols[i], cardSymbols[j]] = [cardSymbols[j], cardSymbols[i]];
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
            cardSymbols.forEach((symbol, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.symbol = symbol;
                card.dataset.index = index;
                
                const cardFront = document.createElement('div');
                cardFront.className = 'card-face card-front';
                cardFront.textContent = symbol;
                
                const cardBack = document.createElement('div');
                cardBack.className = 'card-face card-back';
                
                card.appendChild(cardFront);
                card.appendChild(cardBack);
                card.addEventListener('click', flipCard);
                
                gameBoard.appendChild(card);
                cards.push(card);
            });
        }
        
        // Ù‚Ù„Ø¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
        function flipCard() {
            if (!gameStarted) {
                startTimer();
                gameStarted = true;
            }
            
            const selectedCard = this;
            
            // Ù„Ø§ ØªØ³Ù…Ø­ Ø¨Ù‚Ù„Ø¨ Ø¨Ø·Ø§Ù‚Ø© Ù…Ù‚Ù„ÙˆØ¨Ø© Ø£Ùˆ Ù…ØªØ·Ø§Ø¨Ù‚Ø©
            if (flippedCards.includes(selectedCard) || selectedCard.classList.contains('matched')) {
                return;
            }
            
            // Ù„Ø§ ØªØ³Ù…Ø­ Ø¨Ù‚Ù„Ø¨ Ø£ÙƒØ«Ø± Ù…Ù† Ø¨Ø·Ø§Ù‚ØªÙŠÙ†
            if (flippedCards.length >= 2) {
                return;
            }
            
            // Ù‚Ù„Ø¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
            selectedCard.classList.add('flipped');
            flippedCards.push(selectedCard);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ·Ø§Ø¨Ù‚ Ø¹Ù†Ø¯ Ù‚Ù„Ø¨ Ø¨Ø·Ø§Ù‚ØªÙŠÙ†
            if (flippedCards.length === 2) {
                moves++;
                movesDisplay.textContent = moves;
                
                const [firstCard, secondCard] = flippedCards;
                
                if (firstCard.dataset.symbol === secondCard.dataset.symbol) {
                    // ØªØ·Ø§Ø¨Ù‚ Ù†Ø§Ø¬Ø­
                    firstCard.classList.add('matched');
                    secondCard.classList.add('matched');
                    matchedPairs++;
                    pairsDisplay.textContent = `${matchedPairs} / ${totalPairs}`;
                    flippedCards = [];
                    
                    // ØªØ´ØºÙŠÙ„ ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Ø¬Ø§Ø­
                    playSuccessEffect(firstCard);
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙÙˆØ²
                    if (matchedPairs === totalPairs) {
                        clearInterval(timer);
                        setTimeout(() => {
                            celebrate();
                            alert(`Ù…Ø¨Ø±ÙˆÙƒ! Ù„Ù‚Ø¯ ÙØ²Øª Ø¨Ù€ ${moves} Ù…Ø­Ø§ÙˆÙ„Ø© ÙˆÙÙŠ ${formatTime(seconds)}!`);
                        }, 500);
                    }
                } else {
                    // Ø¹Ø¯Ù… ØªØ·Ø§Ø¨Ù‚
                    setTimeout(() => {
                        firstCard.classList.remove('flipped');
                        secondCard.classList.remove('flipped');
                        flippedCards = [];
                    }, 1000);
                }
            }
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
        function startTimer() {
            clearInterval(timer);
            seconds = 0;
            updateTimer();
            timer = setInterval(() => {
                seconds++;
                updateTimer();
                
                // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
                const progressPercentage = 100 - Math.min(100, (seconds / 120) * 100);
                timerProgress.style.width = `${progressPercentage}%`;
                
                // ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙ†ÙØ¯ Ø§Ù„ÙˆÙ‚Øª
                if (progressPercentage < 20) {
                    timerProgress.style.background = 'linear-gradient(90deg, #f44336, #ff9800)';
                }
            }, 1000);
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¤Ù‚Øª
        function updateTimer() {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }
        
        // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª
        function formatTime(totalSeconds) {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${minutes} Ø¯Ù‚ÙŠÙ‚Ø© Ùˆ ${seconds} Ø«Ø§Ù†ÙŠØ©`;
        }
        
        // ØªØ£Ø«ÙŠØ± Ø§Ù„Ù†Ø¬Ø§Ø­ Ø¹Ù†Ø¯ Ø§Ù„ØªØ·Ø§Ø¨Ù‚
        function playSuccessEffect(card) {
            const rect = card.getBoundingClientRect();
            const confetti = document.createElement('div');
            confetti.style.position = 'fixed';
            confetti.style.left = `${rect.left + rect.width / 2}px`;
            confetti.style.top = `${rect.top + rect.height / 2}px`;
            confetti.style.width = '10px';
            confetti.style.height = '10px';
            confetti.style.backgroundColor = 'gold';
            confetti.style.borderRadius = '50%';
            confetti.style.zIndex = '50';
            document.body.appendChild(confetti);
            
            // ØªØ­Ø±ÙŠÙƒ Ø§Ù„ØªØ£Ø«ÙŠØ±
            const animation = confetti.animate([
                { transform: 'scale(1)', opacity: 1 },
                { transform: 'scale(3)', opacity: 0 }
            ], {
                duration: 1000,
                easing: 'ease-out'
            });
            
            animation.onfinish = () => {
                confetti.remove();
            };
        }
        
        // ØªØ£Ø«ÙŠØ± Ø§Ù„ÙÙˆØ²
        function celebrate() {
            celebration.style.display = 'block';
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø§Ø­ØªÙØ§Ù„
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.style.position = 'absolute';
                particle.style.width = `${Math.random() * 10 + 5}px`;
                particle.style.height = particle.style.width;
                particle.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                particle.style.borderRadius = '50%';
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                celebration.appendChild(particle);
                
                // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª
                const animation = particle.animate([
                    { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                    { transform: `translate(${Math.random() * 200 - 100}px, ${Math.random() * 200 - 100}px) scale(0)`, opacity: 0 }
                ], {
                    duration: Math.random() * 2000 + 1000,
                    easing: 'ease-out'
                });
                
                animation.onfinish = () => {
                    particle.remove();
                };
            }
            
            setTimeout(() => {
                celebration.style.display = 'none';
                celebration.innerHTML = '';
            }, 3000);
        }
        
        // Ù…ÙŠØ²Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
        function giveHint() {
            if (!hintAvailable || flippedCards.length > 0 || matchedPairs === totalPairs) return;
            
            hintAvailable = false;
            hintBtn.disabled = true;
            
            // Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨Ø·Ø§Ù‚Ø§Øª ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø© ÙˆØºÙŠØ± Ù…Ù‚Ù„ÙˆØ¨Ø©
            const unflippedCards = Array.from(cards).filter(card => 
                !card.classList.contains('matched') && 
                !card.classList.contains('flipped')
            );
            
            if (unflippedCards.length < 2) return;
            
            // Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø²ÙˆØ¬ Ù…ØªØ·Ø§Ø¨Ù‚
            const cardMap = {};
            let hintCards = [];
            
            for (const card of unflippedCards) {
                const symbol = card.dataset.symbol;
                if (cardMap[symbol]) {
                    hintCards = [cardMap[symbol], card];
                    break;
                }
                cardMap[symbol] = card;
            }
            
            if (hintCards.length === 2) {
                // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø´Ø§Ø±Ø©
                hintCards.forEach(card => {
                    card.style.boxShadow = '0 0 15px yellow';
                });
                
                setTimeout(() => {
                    hintCards.forEach(card => {
                        card.style.boxShadow = '';
                    });
                }, 2000);
            }
        }
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        restartBtn.addEventListener('click', initGame);
        hintBtn.addEventListener('click', giveHint);
        easyBtn.addEventListener('click', () => {
            boardSize = 'easy';
            initGame();
        });
        mediumBtn.addEventListener('click', () => {
            boardSize = 'medium';
            initGame();
        });
        hardBtn.addEventListener('click', () => {
            boardSize = 'hard';
            initGame();
        });
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©
        initGame();
    </script>
{% endblock %}